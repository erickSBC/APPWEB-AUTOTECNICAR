<!--
=========================================================
* Corporate UI - Perfil de Usuario (Enhanced)
=========================================================
-->
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <title>Perfil de Usuario</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Noto+Sans:300,400,500,600,700,800|PT+Mono:300,400,500,600,700" rel="stylesheet" />
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/349ee9c857.js" crossorigin="anonymous"></script>
  <link id="pagestyle" href="../assets/css/corporate-ui-dashboard.css?v=1.0.0" rel="stylesheet" />
  <style>
    .profile-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 20px; border-radius: 8px; text-align: center; }
    .profile-avatar { width: 120px; height: 120px; border: 5px solid white; border-radius: 50%; object-fit: cover; margin-bottom: 15px; }
    .tab-button { padding: 12px 20px; background: #f0f0f0; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; margin-right: 10px; margin-bottom: 15px; transition: all 0.3s; }
    .tab-button.active { background: #667eea; color: white; }
    .tab-button:hover { transform: translateY(-2px); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .alert-info { background-color: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px 15px; border-radius: 4px; margin-bottom: 20px; }
    .stat-box { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border: 1px solid #dee2e6; }
    .stat-box h6 { color: #667eea; font-weight: 600; }
    .stat-box .value { font-size: 1.5rem; font-weight: bold; }
    .form-section-title { font-size: 1.1rem; font-weight: 600; color: #333; margin-top: 25px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
    .password-strength { height: 4px; background: #e9ecef; border-radius: 2px; margin-top: 5px; }
    .password-strength.weak { background: #dc3545; }
    .password-strength.medium { background: #ffc107; }
    .password-strength.strong { background: #28a745; }
    .strength-text { font-size: 0.85rem; margin-top: 3px; }
    .strength-text.weak { color: #dc3545; }
    .strength-text.medium { color: #ffc107; }
    .strength-text.strong { color: #28a745; }
    .success-message { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 12px 15px; border-radius: 4px; margin-bottom: 15px; display: none; }
    .error-message { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 12px 15px; border-radius: 4px; margin-bottom: 15px; display: none; }
    .arrow-box { background: #5a5a5e; padding: 6px 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
    .arrow-box i.material-icons { color: white; font-size: 18px; }
    .arrow-box i { transition: transform .25s; }
    .nav-link[aria-expanded="true"] .arrow-box i { transform: rotate(180deg); }
    
    @media (min-width:1200px){
      aside.sidenav{ width:260px; }
      main.main-content{ transition: margin-left .25s ease; margin-left:260px; }
      body.my-sidenav-collapsed main.main-content{ margin-left:0 !important; }
    }

    #sidenav-backdrop{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:1040; }
    body.my-sidenav-open #sidenav-backdrop{ display:block; }
    @media (min-width:1200px){ #sidenav-backdrop{ display:none !important; } }
  </style>
</head>

<body class="g-sidenav-show bg-gray-100">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 bg-slate-900 fixed-start" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand d-flex align-items-center m-0" href="dashboard.html">
        <span class="font-weight-bold text-lg">D'Cesar</span>
      </a>
    </div>
    <div class="collapse navbar-collapse px-4 w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="dashboard.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-th text-lg text-white"></i></div><span class="nav-link-text ms-1">Dashboard</span></a></li>
        
        <li class="nav-item"><a class="nav-link collapsed" data-bs-toggle="collapse" href="#ventas-submenu" role="button" aria-expanded="false"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-store text-lg text-white"></i></div><span class="nav-link-text ms-1">Ventas</span><i class="fas fa-chevron-down ms-auto text-white"></i></a>
          <div class="collapse" id="ventas-submenu">
            <ul class="nav ms-2">
              <li class="nav-item"><a class="nav-link" href="new-sale.html"><span class="nav-link-text">Nueva Venta</span></a></li>
              <li class="nav-item"><a class="nav-link" href="sales-list.html"><span class="nav-link-text">Lista de Ventas</span></a></li>
              <li class="nav-item"><a class="nav-link" href="pay.html"><span class="nav-link-text">Pagos</span></a></li>
            </ul>
          </div>
        </li>

        <li class="nav-item"><a class="nav-link" href="productos.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-box text-lg text-white"></i></div><span class="nav-link-text ms-1">Inventario</span></a></li>
        
        <li class="nav-item"><a class="nav-link" href="users-list.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-users text-lg text-white"></i></div><span class="nav-link-text ms-1">Usuarios</span></a></li>
        
        <li class="nav-item"><a class="nav-link" href="reportes.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-chart-bar text-lg text-white"></i></div><span class="nav-link-text ms-1">Reportes</span></a></li>

        <li class="nav-item"><a class="nav-link" href="notificaciones.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-bell text-lg text-white"></i></div><span class="nav-link-text ms-1">Notificaciones</span></a></li>
      </ul>
    </div>
    <div class="sidenav-footer mx-3 mt-3 pt-3 border-top">
      <a class="btn btn-dark w-100" href="profile.html"><i class="fas fa-user-circle me-2"></i>Mi Perfil</a>
    </div>
  </aside>

  <div id="sidenav-backdrop"></div>

  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <nav class="navbar navbar-main navbar-expand-lg mx-5 px-0 shadow-none rounded" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-2">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-1 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="dashboard.html">Dashboard</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Mi Perfil</li>
          </ol>
          <h6 class="font-weight-bold mb-0">Perfil de Usuario</h6>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
            <button class="btn btn-sm btn-white" onclick="logout()">
              <i class="fa fa-sign-out me-2"></i>Cerrar Sesión
            </button>
          </div>
        </div>
      </div>
    </nav>

    <div class="container-fluid py-4 px-5">
      <!-- PROFILE HEADER -->
      <div class="row mb-4">
        <div class="col-lg-12">
          <div class="profile-header">
            <div id="avatar-container">
              <img src="https://via.placeholder.com/120?text=Usuario" class="profile-avatar" id="profile-avatar" alt="Foto de perfil">
            </div>
            <h4 id="profile-name" class="mb-1">Nombre del Usuario</h4>
            <p id="profile-role" class="mb-0 opacity-8">Rol del usuario</p>
          </div>
        </div>
      </div>

      <!-- STATS -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6">
          <div class="stat-box">
            <h6>Estado</h6>
            <div class="value" id="stat-status">Activo</div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="stat-box">
            <h6>Teléfono</h6>
            <div class="value" id="stat-phone" style="font-size: 1rem;">—</div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="stat-box">
            <h6>Correo</h6>
            <div class="value" id="stat-email" style="font-size: 0.9rem;">—</div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="stat-box">
            <h6>Miembro desde</h6>
            <div class="value" id="stat-joined" style="font-size: 0.9rem;">—</div>
          </div>
        </div>
      </div>

      <!-- TABS -->
      <div class="row">
        <div class="col-lg-12">
          <div class="card shadow-xs border">
            <div class="card-header border-bottom pb-3">
              <div class="d-flex gap-2">
                <button class="tab-button active" onclick="switchTab('informacion')">
                  <i class="fa fa-user me-2"></i>Información Personal
                </button>
                <button class="tab-button" onclick="switchTab('seguridad')">
                  <i class="fa fa-lock me-2"></i>Seguridad
                </button>
                <button class="tab-button" onclick="switchTab('preferencias')">
                  <i class="fa fa-cog me-2"></i>Preferencias
                </button>
              </div>
            </div>

            <div class="card-body p-4">
              <!-- TAB 1: INFORMACIÓN PERSONAL -->
              <div id="informacion" class="tab-content active">
                <div class="success-message" id="info-success">✓ Información actualizada correctamente</div>
                <div class="error-message" id="info-error"></div>

                <div class="form-section-title">Datos Personales</div>
                <form id="info-form">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label font-weight-semibold">Nombre Completo *</label>
                      <input type="text" class="form-control" placeholder="Tu nombre completo" id="info-name" required>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label font-weight-semibold">Correo Electrónico *</label>
                      <input type="email" class="form-control" placeholder="tu@email.com" id="info-email" required>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label font-weight-semibold">Teléfono</label>
                      <input type="tel" class="form-control" placeholder="+51 999 123 456" id="info-phone">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label font-weight-semibold">Cargo/Rol</label>
                      <input type="text" class="form-control" placeholder="Tu cargo" id="info-role" disabled>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-12 mb-3">
                      <label class="form-label font-weight-semibold">Dirección</label>
                      <input type="text" class="form-control" placeholder="Tu dirección completa" id="info-address">
                    </div>
                  </div>

                  <div class="form-section-title" style="margin-top: 30px;">Foto de Perfil</div>
                  <div class="row">
                    <div class="col-md-12 mb-3">
                      <div id="avatar-preview-container" style="margin-bottom: 15px;">
                        <img id="avatar-preview" src="" alt="preview" style="max-width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea;">
                      </div>
                      <input type="file" class="form-control" accept="image/*" id="info-avatar" onchange="previewAvatar(event)">
                      <small class="text-secondary">Máximo 2MB. Formatos: JPG, PNG</small>
                    </div>
                  </div>

                  <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-dark">
                      <i class="fa fa-save me-2"></i>Guardar Cambios
                    </button>
                    <button type="button" class="btn btn-white" onclick="resetInfoForm()">
                      <i class="fa fa-undo me-2"></i>Cancelar
                    </button>
                  </div>
                </form>
              </div>

              <!-- TAB 2: SEGURIDAD -->
              <div id="seguridad" class="tab-content">
                <div class="success-message" id="security-success">✓ Contraseña cambiada correctamente</div>
                <div class="error-message" id="security-error"></div>

                <div class="alert-info">
                  <i class="fa fa-info-circle me-2"></i>
                  <strong>Seguridad:</strong> Cambiar tu contraseña regularmente te ayuda a proteger tu cuenta.
                </div>

                <div class="form-section-title">Cambiar Contraseña</div>
                <form id="security-form">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label font-weight-semibold">Contraseña Actual *</label>
                      <input type="password" class="form-control" placeholder="Tu contraseña actual" id="security-current" required>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label font-weight-semibold">Nueva Contraseña *</label>
                      <input type="password" class="form-control" placeholder="Nueva contraseña" id="security-new" required onkeyup="calculatePasswordStrength()">
                      <div class="password-strength" id="strength-bar"></div>
                      <small class="strength-text" id="strength-text"></small>
                      <small class="d-block text-secondary mt-2">Mínimo 8 caracteres, 1 mayúscula, 1 número</small>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label font-weight-semibold">Confirmar Nueva Contraseña *</label>
                      <input type="password" class="form-control" placeholder="Confirma tu nueva contraseña" id="security-confirm" required>
                    </div>
                  </div>

                  <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-dark">
                      <i class="fa fa-lock me-2"></i>Actualizar Contraseña
                    </button>
                    <button type="button" class="btn btn-white" onclick="resetSecurityForm()">
                      <i class="fa fa-undo me-2"></i>Cancelar
                    </button>
                  </div>
                </form>

                <div class="form-section-title" style="margin-top: 40px;">Sesiones Activas</div>
                <div class="alert-info">
                  <i class="fa fa-laptop me-2"></i>
                  <strong>Sesión Actual:</strong> Chrome en Windows (127.0.0.1) - Ahora mismo
                </div>
                <button class="btn btn-sm btn-danger" onclick="logoutOtherSessions()">
                  <i class="fa fa-sign-out me-2"></i>Cerrar otras sesiones
                </button>
              </div>

              <!-- TAB 3: PREFERENCIAS -->
              <div id="preferencias" class="tab-content">
                <div class="success-message" id="prefs-success">✓ Preferencias guardadas</div>

                <div class="form-section-title">Notificaciones por Email</div>
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="pref-email-news" checked>
                      <label class="form-check-label" for="pref-email-news">
                        <strong>Noticias y actualizaciones</strong>
                        <small class="d-block text-secondary">Recibe información sobre nuevas funciones y actualizaciones del sistema</small>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12">
                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="pref-email-reports" checked>
                      <label class="form-check-label" for="pref-email-reports">
                        <strong>Reportes semanales</strong>
                        <small class="d-block text-secondary">Recibe un resumen semanal de ventas y movimientos</small>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12">
                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="pref-email-alerts">
                      <label class="form-check-label" for="pref-email-alerts">
                        <strong>Alertas de stock bajo</strong>
                        <small class="d-block text-secondary">Notificaciones cuando el stock de un producto cae por debajo del mínimo</small>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12">
                    <div class="form-check mb-4">
                      <input class="form-check-input" type="checkbox" id="pref-email-security">
                      <label class="form-check-label" for="pref-email-security">
                        <strong>Alertas de seguridad</strong>
                        <small class="d-block text-secondary">Notificaciones de intentos de acceso y cambios de seguridad</small>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="form-section-title" style="margin-top: 30px;">Preferencias de Interfaz</div>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label font-weight-semibold">Idioma</label>
                    <select class="form-control" id="pref-language">
                      <option value="es">Español</option>
                      <option value="en">English</option>
                      <option value="pt">Português</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label font-weight-semibold">Zona Horaria</label>
                    <select class="form-control" id="pref-timezone">
                      <option value="america/lima">Lima (UTC -5)</option>
                      <option value="america/caracas">Caracas (UTC -4)</option>
                      <option value="america/bogota">Bogotá (UTC -5)</option>
                    </select>
                  </div>
                </div>

                <div class="d-flex gap-2 mt-4">
                  <button class="btn btn-dark" onclick="savePreferences()">
                    <i class="fa fa-save me-2"></i>Guardar Preferencias
                  </button>
                  <button class="btn btn-white" onclick="resetPreferencesForm()">
                    <i class="fa fa-undo me-2"></i>Cancelar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- DANGER ZONE -->
      <div class="row mt-4">
        <div class="col-lg-12">
          <div class="card shadow-xs border" style="border-color: #dc3545;">
            <div class="card-header border-bottom pb-3" style="background-color: #fff5f5;">
              <h6 class="font-weight-semibold text-danger mb-0">
                <i class="fa fa-exclamation-triangle me-2"></i>Zona de Peligro
              </h6>
            </div>
            <div class="card-body p-4">
              <p class="text-muted mb-3">
                Acciones irreversibles. Por favor, procede con cuidado.
              </p>
              <button class="btn btn-outline-danger" onclick="deleteAccount()">
                <i class="fa fa-trash me-2"></i>Eliminar mi Cuenta
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer pt-3">
      <div class="container-fluid">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-lg-6 mb-lg-0 mb-4">
            <div class="copyright text-center text-xs text-muted text-lg-start">
              Copyright © <script>document.write(new Date().getFullYear())</script> D'Cesar - Todos los derechos reservados
            </div>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/corporate-ui-dashboard.min.js?v=1.0.0"></script>

  <script>
    // ========== STATE ==========
    let currentUser = {
      name: 'Juan Díaz Martínez',
      email: 'juan.diaz@empresa.com',
      phone: '+51 999 123 456',
      role: 'Administrador',
      status: 'Activo',
      address: 'Av. Principal 123, Lima, Perú',
      joined: '2024-01-15',
      avatar: 'https://via.placeholder.com/120?text=JD',
      currentPassword: 'password123'
    };

    let preferences = {
      emailNews: true,
      emailReports: true,
      emailAlerts: false,
      emailSecurity: true,
      language: 'es',
      timezone: 'america/lima'
    };

    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
      setupSidebar();
      loadProfileData();
      setupFormListeners();
    });

    function setupSidebar() {
      const icon = document.getElementById('iconSidenav');
      const backdrop = document.getElementById('sidenav-backdrop');

      if(icon) {
        icon.addEventListener('click', function(){
          document.body.classList.toggle('my-sidenav-open');
        });
      }

      if(backdrop) {
        backdrop.addEventListener('click', function(){
          document.body.classList.remove('my-sidenav-open');
        });
      }
    }

    function loadProfileData() {
      document.getElementById('profile-name').textContent = currentUser.name;
      document.getElementById('profile-role').textContent = currentUser.role;
      document.getElementById('profile-avatar').src = currentUser.avatar;
      document.getElementById('stat-status').textContent = currentUser.status;
      document.getElementById('stat-phone').textContent = currentUser.phone || '—';
      document.getElementById('stat-email').textContent = currentUser.email;
      document.getElementById('stat-joined').textContent = new Date(currentUser.joined).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' });

      // Load form
      document.getElementById('info-name').value = currentUser.name;
      document.getElementById('info-email').value = currentUser.email;
      document.getElementById('info-phone').value = currentUser.phone;
      document.getElementById('info-role').value = currentUser.role;
      document.getElementById('info-address').value = currentUser.address;

      // Load preferences
      document.getElementById('pref-email-news').checked = preferences.emailNews;
      document.getElementById('pref-email-reports').checked = preferences.emailReports;
      document.getElementById('pref-email-alerts').checked = preferences.emailAlerts;
      document.getElementById('pref-email-security').checked = preferences.emailSecurity;
      document.getElementById('pref-language').value = preferences.language;
      document.getElementById('pref-timezone').value = preferences.timezone;
    }

    function setupFormListeners() {
      document.getElementById('info-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveProfileInfo();
      });

      document.getElementById('security-form').addEventListener('submit', function(e) {
        e.preventDefault();
        changePassword();
      });
    }

    // ========== TAB SWITCHING ==========
    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    // ========== INFORMACIÓN PERSONAL ==========
    function previewAvatar(event) {
      const file = event.target.files[0];
      if(!file) return;

      if(file.size > 2 * 1024 * 1024) {
        showError('info-error', 'La imagen no puede exceder 2MB');
        event.target.value = '';
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const preview = document.getElementById('avatar-preview');
        preview.src = e.target.result;
        document.getElementById('avatar-preview-container').style.display = 'block';
        currentUser.avatar = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function saveProfileInfo() {
      const name = document.getElementById('info-name').value.trim();
      const email = document.getElementById('info-email').value.trim();
      const phone = document.getElementById('info-phone').value.trim();
      const address = document.getElementById('info-address').value.trim();

      if(!name || !email) {
        showError('info-error', 'Completa todos los campos obligatorios');
        return;
      }

      const emailRegex = /^[\w\.\-]+@[\w\.\-]+\.\w+$/;
      if(!emailRegex.test(email)) {
        showError('info-error', 'El correo no es válido');
        return;
      }

      currentUser.name = name;
      currentUser.email = email;
      currentUser.phone = phone;
      currentUser.address = address;

      loadProfileData();
      showSuccess('info-success');
    }

    function resetInfoForm() {
      document.getElementById('info-form').reset();
      loadProfileData();
    }

    // ========== SEGURIDAD ==========
    function calculatePasswordStrength() {
      const pwd = document.getElementById('security-new').value;
      const bar = document.getElementById('strength-bar');
      const text = document.getElementById('strength-text');

      let strength = 0;
      if(pwd.length >= 8) strength++;
      if(/[A-Z]/.test(pwd)) strength++;
      if(/[0-9]/.test(pwd)) strength++;
      if(/[!@#$%^&*]/.test(pwd)) strength++;

      bar.className = 'password-strength';
      text.className = 'strength-text';

      if(strength <= 1) {
        bar.classList.add('weak');
        text.classList.add('weak');
        text.textContent = '⚠ Contraseña débil';
      } else if(strength === 2 || strength === 3) {
        bar.classList.add('medium');
        text.classList.add('medium');
        text.textContent = '◐ Contraseña media';
      } else {
        bar.classList.add('strong');
        text.classList.add('strong');
        text.textContent = '✓ Contraseña fuerte';
      }
    }

    function changePassword() {
      const current = document.getElementById('security-current').value;
      const newPwd = document.getElementById('security-new').value;
      const confirm = document.getElementById('security-confirm').value;

      if(!current || !newPwd || !confirm) {
        showError('security-error', 'Completa todos los campos');
        return;
      }

      if(current !== currentUser.currentPassword) {
        showError('security-error', 'La contraseña actual es incorrecta');
        return;
      }

      const pwdRegex = /^(?=.*[A-Z])(?=.*[0-9]).{8,}$/;
      if(!pwdRegex.test(newPwd)) {
        showError('security-error', 'La nueva contraseña no cumple los requisitos');
        return;
      }

      if(newPwd !== confirm) {
        showError('security-error', 'Las contraseñas no coinciden');
        return;
      }

      currentUser.currentPassword = newPwd;
      document.getElementById('security-form').reset();
      document.getElementById('strength-bar').className = 'password-strength';
      document.getElementById('strength-text').textContent = '';
      showSuccess('security-success');
    }

    function resetSecurityForm() {
      document.getElementById('security-form').reset();
      document.getElementById('strength-bar').className = 'password-strength';
      document.getElementById('strength-text').textContent = '';
    }

    function logoutOtherSessions() {
      if(confirm('¿Cerrar todas las demás sesiones?')) {
        alert('✓ Sesiones cerradas correctamente');
      }
    }

    // ========== PREFERENCIAS ==========
    function savePreferences() {
      preferences.emailNews = document.getElementById('pref-email-news').checked;
      preferences.emailReports = document.getElementById('pref-email-reports').checked;
      preferences.emailAlerts = document.getElementById('pref-email-alerts').checked;
      preferences.emailSecurity = document.getElementById('pref-email-security').checked;
      preferences.language = document.getElementById('pref-language').value;
      preferences.timezone = document.getElementById('pref-timezone').value;

      showSuccess('prefs-success');
    }

    function resetPreferencesForm() {
      loadProfileData();
    }

    // ========== DANGER ZONE ==========
    function deleteAccount() {
      const confirmed = confirm('⚠️ ¿Estás seguro? Esta acción es IRREVERSIBLE.\n\nEscribe "ELIMINAR" para confirmar');
      if(confirmed) {
        const text = prompt('Para confirmar, escribe: ELIMINAR');
        if(text === 'ELIMINAR') {
          alert('Tu cuenta ha sido eliminada. Serás redirigido...');
          window.location.href = 'sign-in.html';
        } else {
          alert('Cancelado: Texto incorrecto');
        }
      }
    }

    // ========== UTILITIES ==========
    function showSuccess(elementId) {
      const el = document.getElementById(elementId);
      el.style.display = 'block';
      setTimeout(() => {
        el.style.display = 'none';
      }, 4000);
    }

    function showError(elementId, message) {
      const el = document.getElementById(elementId);
      el.textContent = '✗ ' + message;
      el.style.display = 'block';
      setTimeout(() => {
        el.style.display = 'none';
      }, 4000);
    }

    function logout() {
      if(confirm('¿Cerrar sesión?')) {
        window.location.href = 'sign-in.html';
      }
    }
  </script>

</body>

</html>
