<!--
=========================================================
* Corporate UI - Lista de Ventas
=========================================================
-->
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <title>Lista de Ventas</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Noto+Sans:300,400,500,600,700,800|PT+Mono:300,400,500,600,700" rel="stylesheet" />
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/349ee9c857.js" crossorigin="anonymous"></script>
  <link id="pagestyle" href="../assets/css/corporate-ui-dashboard.css?v=1.0.0" rel="stylesheet" />
  <style>
    .filter-card { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
    .badge-status { padding: 6px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 600; }
    .badge-pendiente { background: #ffeaa7; color: #d63031; }
    .badge-confirmado { background: #b2ebf2; color: #01579b; }
    .badge-enviado { background: #b2dfdb; color: #004d40; }
    .badge-entregado { background: #c8e6c9; color: #1b5e20; }
    .badge-cancelado { background: #ffccbc; color: #bf360c; }
    .modal-body { max-height: 80vh; overflow-y: auto; }
    .detail-row { border-bottom: 1px solid #e9ecef; padding: 10px 0; }
    .detail-row:last-child { border-bottom: none; }
    @media (min-width:1200px){
      aside.sidenav{ width:260px; }
      main.main-content{ transition: margin-left .25s ease; margin-left:260px; }
      body.my-sidenav-collapsed main.main-content{ margin-left:0 !important; }
    }
    #sidenav-backdrop{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:1040; }
    body.my-sidenav-open #sidenav-backdrop{ display:block; }
    @media (min-width:1200px){ #sidenav-backdrop{ display:none !important; } }
  </style>
</head>

<body class="g-sidenav-show bg-gray-100">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 bg-slate-900 fixed-start" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand d-flex align-items-center m-0" href="dashboard.html">
        <span class="font-weight-bold text-lg">D'Cesar</span>
      </a>
    </div>
    <div class="collapse navbar-collapse px-4 w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="dashboard.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-th text-lg text-white"></i></div><span class="nav-link-text ms-1">Dashboard</span></a></li>
        
        <li class="nav-item"><a class="nav-link collapsed" data-bs-toggle="collapse" href="#ventas-submenu" role="button" aria-expanded="true"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-store text-lg text-white"></i></div><span class="nav-link-text ms-1">Ventas</span><i class="fas fa-chevron-down ms-auto text-white"></i></a>
          <div class="collapse show" id="ventas-submenu">
            <ul class="nav ms-2">
              <li class="nav-item"><a class="nav-link" href="new-sale.html"><span class="nav-link-text">Nueva Venta</span></a></li>
              <li class="nav-item"><a class="nav-link active" href="sales-list.html"><span class="nav-link-text">Lista de Ventas</span></a></li>
              <li class="nav-item"><a class="nav-link" href="pay.html"><span class="nav-link-text">Pagos</span></a></li>
            </ul>
          </div>
        </li>

        <li class="nav-item"><a class="nav-link" href="productos.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-box text-lg text-white"></i></div><span class="nav-link-text ms-1">Inventario</span></a></li>
        
        <li class="nav-item"><a class="nav-link" href="users-list.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-users text-lg text-white"></i></div><span class="nav-link-text ms-1">Usuarios</span></a></li>
        
        <li class="nav-item"><a class="nav-link" href="reportes.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-chart-bar text-lg text-white"></i></div><span class="nav-link-text ms-1">Reportes</span></a></li>

        <li class="nav-item"><a class="nav-link" href="notificaciones.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><i class="fas fa-bell text-lg text-white"></i></div><span class="nav-link-text ms-1">Notificaciones</span></a></li>
      </ul>
    </div>
    <div class="sidenav-footer mx-3 mt-3 pt-3 border-top">
      <a class="btn btn-dark w-100" href="profile.html"><i class="fas fa-user-circle me-2"></i>Mi Perfil</a>
    </div>
  </aside>

  <div id="sidenav-backdrop"></div>

  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <nav class="navbar navbar-main navbar-expand-lg mx-5 px-0 shadow-none rounded" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-2">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-1 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="dashboard.html">Dashboard</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Lista de Ventas</li>
          </ol>
          <h6 class="font-weight-bold mb-0">Gestión de Pedidos</h6>
        </nav>
      </div>
    </nav>

    <div class="container-fluid py-4 px-5">
      <div class="row mb-4">
        <div class="col-md-12">
          <h3 class="font-weight-bold">Lista de Ventas y Pedidos</h3>
        </div>
      </div>

      <!-- FILTROS -->
      <div class="filter-card">
        <div class="row g-2 align-items-end">
          <div class="col-md-2">
            <input type="text" class="form-control form-control-sm" id="search-sales" placeholder="Buscar orden, cliente..." onkeyup="filterSales()">
          </div>
          <div class="col-md-2">
            <input type="date" class="form-control form-control-sm" id="filter-date-from">
          </div>
          <div class="col-md-2">
            <input type="date" class="form-control form-control-sm" id="filter-date-to">
          </div>
          <div class="col-md-2">
            <select class="form-control form-control-sm" id="filter-status" onchange="filterSales()">
              <option value="">Todos los estados</option>
              <option value="pendiente">Pendiente</option>
              <option value="confirmado">Confirmado</option>
              <option value="enviado">Enviado</option>
              <option value="entregado">Entregado</option>
              <option value="cancelado">Cancelado</option>
            </select>
          </div>
          <div class="col-md-2">
            <button class="btn btn-sm btn-dark w-100" onclick="filterSales()"><i class="fa fa-search me-1"></i>Buscar</button>
          </div>
          <div class="col-md-2">
            <button class="btn btn-sm btn-white w-100" onclick="clearSalesFilters()"><i class="fa fa-redo me-1"></i>Limpiar</button>
          </div>
        </div>
      </div>

      <!-- TABLA DE VENTAS -->
      <div class="row">
        <div class="col-lg-12">
          <div class="card shadow-xs border">
            <div class="card-header border-bottom pb-3">
              <h6 class="font-weight-semibold mb-0">Órdenes de Venta</h6>
            </div>
            <div class="card-body px-0 py-0">
              <div class="table-responsive p-3">
                <table class="table table-hover align-items-center mb-0">
                  <thead class="bg-light">
                    <tr>
                      <th>Orden</th>
                      <th>Fecha</th>
                      <th>Cliente</th>
                      <th>Producto</th>
                      <th>Cantidad</th>
                      <th>Total</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="sales-tbody">
                    <!-- Se cargarán las ventas aquí -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PAGINACION -->
      <div class="row mt-3">
        <div class="col-lg-12 text-center">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
              <div>
                <button class="btn btn-sm btn-outline" onclick="exportSalesCSV()"><i class="fa fa-file-csv me-1"></i>Exportar CSV</button>
              </div>
              <div id="paginationContainer"></div>
            </div>
          </div>
      </div>
    </div>

    <footer class="footer pt-3">
      <div class="container-fluid">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-lg-6 mb-lg-0 mb-4">
            <div class="copyright text-center text-xs text-muted text-lg-start">
              Copyright © <script>document.write(new Date().getFullYear())</script> D'Cesar
            </div>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <!-- MODAL DETALLES -->
  <div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalles de Pedido <span id="modal-order-id"></span></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="detail-row">
            <h6>Información del Pedido</h6>
            <p>Fecha: <strong id="modal-date"></strong> | Cliente: <strong id="modal-client"></strong> | Teléfono: <strong id="modal-phone"></strong></p>
          </div>
          <div class="detail-row">
            <h6>Dirección de Envío</h6>
            <p id="modal-address"></p>
          </div>
          <div class="detail-row">
            <h6>Productos</h6>
            <table class="table table-sm">
              <thead class="bg-light">
                <tr>
                  <th>Producto</th>
                  <th>Cantidad</th>
                  <th>Precio</th>
                  <th>Subtotal</th>
                </tr>
              </thead>
              <tbody id="modal-items"></tbody>
            </table>
          </div>
          <div class="detail-row">
            <h6>Resumen</h6>
            <p>Subtotal: <strong id="modal-subtotal"></strong> | IGV (18%): <strong id="modal-tax"></strong></p>
            <p style="font-size: 1.1rem;">Total: <strong id="modal-total" style="color: #667eea;"></strong></p>
          </div>
          <div class="detail-row">
            <h6>Cambiar Estado</h6>
            <select class="form-control form-control-sm" id="modal-status-select" onchange="updateOrderStatus()" style="max-width: 200px;">
              <option value="pendiente">Pendiente</option>
              <option value="confirmado">Confirmado</option>
              <option value="enviado">Enviado</option>
              <option value="entregado">Entregado</option>
              <option value="cancelado">Cancelado</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-sm btn-white" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-sm btn-primary" onclick="printOrder()"><i class="fa fa-print me-1"></i>Imprimir</button>
        </div>
      </div>
    </div>
  </div>

  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/corporate-ui-dashboard.min.js?v=1.0.0"></script>

  <script>
    const itemsPerPage = 10;
    let currentPage = 1;
    let currentSaleId = null;

    // Load sales from LocalStorage; if none present, initialize with sample data
    let allSales = [];
    const sampleKey = 'sales';
    const stored = localStorage.getItem(sampleKey);
    if(stored) {
      try { allSales = JSON.parse(stored); } catch(e){ allSales = []; }
    }
    if(!allSales || allSales.length === 0) {
      allSales = [
        { id: '2024-001', date: '2024-11-25', client: 'Juan García Loor', phone: '+51 999 123 456', address: 'Av. Libertad 456, Lima', product: 'Foco LED H7', qty: 5, price: 45.90, status: 'pendiente', total: (5*45.90) },
        { id: '2024-002', date: '2024-11-25', client: 'María Rodríguez', phone: '+51 987 654 321', address: 'Calle Amazonas 789, Lima', product: 'Alternador Denso', qty: 2, price: 380.50, status: 'confirmado', total: (2*380.50) }
      ];
      localStorage.setItem(sampleKey, JSON.stringify(allSales));
    }
    let filteredSales = [...allSales];

    document.addEventListener('DOMContentLoaded', function() {
      setupSidebar();
      renderSales();
    });

    function setupSidebar() {
      const icon = document.getElementById('iconSidenav');
      const backdrop = document.getElementById('sidenav-backdrop');
      if(icon) icon.addEventListener('click', () => document.body.classList.toggle('my-sidenav-open'));
      if(backdrop) backdrop.addEventListener('click', () => document.body.classList.remove('my-sidenav-open'));
    }

    function getStatusBadge(status) {
      return `<span class="badge-status badge-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>`;
    }

    function renderSales() {
      const tbody = document.getElementById('sales-tbody');
      tbody.innerHTML = '';

      const startIdx = (currentPage - 1) * itemsPerPage;
      const endIdx = startIdx + itemsPerPage;
      const pageSales = filteredSales.slice(startIdx, endIdx);

      if(pageSales.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No hay ventas</td></tr>';
        updatePaginationUI();
        return;
      }

      pageSales.forEach(sale => {
        const total = sale.total !== undefined ? sale.total : (sale.qty * sale.price || 0);
        const row = `
          <tr>
            <td>${sale.id}</td>
            <td>${sale.date}</td>
            <td>${sale.client}</td>
            <td>${sale.product || (sale.items && sale.items.length ? 'Varios' : '')}</td>
            <td>${sale.qty || (sale.items && sale.items.reduce((s,i)=>s+i.qty,0)) || ''}</td>
            <td>S/ ${Number(total).toFixed(2)}</td>
            <td>${getStatusBadge(sale.status)}</td>
            <td>
              <a class="btn btn-xs btn-dark" href="sale-details.html?id=${encodeURIComponent(sale.id)}" title="Ver detalles"><i class="fa fa-eye"></i></a>
              <a class="btn btn-xs btn-success" href="new-payment.html?saleId=${encodeURIComponent(sale.id)}" title="Registrar pago"><i class="fa fa-credit-card"></i></a>
              <button class="btn btn-xs btn-secondary" onclick="duplicateSale('${sale.id}')" title="Duplicar"><i class="fa fa-clone"></i></button>
              <button class="btn btn-xs btn-info" onclick="printSale('${sale.id}')" title="Imprimir"><i class="fa fa-print"></i></button>
              <button class="btn btn-xs btn-white" onclick="downloadSaleCSV('${sale.id}')" title="Descargar"><i class="fa fa-download"></i></button>
              <button class="btn btn-xs btn-danger" onclick="cancelOrder('${sale.id}')" title="Cancelar"><i class="fa fa-times"></i></button>
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      });

      renderPagination();
    }

    function updatePaginationUI() {
      const totalPages = Math.ceil(filteredSales.length / itemsPerPage);
      document.getElementById('total-pages').textContent = totalPages;
      document.getElementById('prev-btn').classList.toggle('disabled', currentPage === 1);
      document.getElementById('next-btn').classList.toggle('disabled', currentPage === totalPages);
    }

    function renderPagination(){
      const totalPages = Math.max(1, Math.ceil(filteredSales.length / itemsPerPage));
      if(currentPage > totalPages) currentPage = totalPages;
      const container = document.getElementById('paginationContainer');
      container.innerHTML = '';
      const createBtn = (text, cls, cb) => { const b = document.createElement('button'); b.className = cls + ' btn btn-sm'; b.style.margin='0 4px'; b.innerHTML = text; b.onclick = cb; return b; };

      container.appendChild(createBtn('<<', 'btn-outline', ()=>{ if(currentPage!==1){ currentPage=1; renderSales(); } }));
      container.appendChild(createBtn('<', 'btn-outline', ()=>{ if(currentPage>1){ currentPage--; renderSales(); } }));

      // pages window
      const maxWindow = 7;
      let start = Math.max(1, currentPage - Math.floor(maxWindow/2));
      let end = Math.min(totalPages, start + maxWindow -1);
      if(end - start < maxWindow -1) start = Math.max(1, end - maxWindow +1);
      for(let p=start;p<=end;p++){
        const cls = p===currentPage ? 'btn-primary' : 'btn-outline';
        const btn = createBtn(p, cls, ()=>{ currentPage=p; renderSales(); });
        container.appendChild(btn);
      }

      container.appendChild(createBtn('>', 'btn-outline', ()=>{ if(currentPage<totalPages){ currentPage++; renderSales(); } }));
      container.appendChild(createBtn('>>', 'btn-outline', ()=>{ if(currentPage!==totalPages){ currentPage=totalPages; renderSales(); } }));
      const info = document.createElement('span'); info.style.marginLeft='12px'; info.textContent = `Página ${currentPage} de ${totalPages}`;
      container.appendChild(info);
    }

    function exportSalesCSV(){
      // export currently filteredSales
      const rows = [['id','date','client','total','status','product_count']];
      filteredSales.forEach(s=>{
        const total = s.total !== undefined ? s.total : (s.qty && s.price ? s.qty*s.price : s.items ? s.items.reduce((a,b)=>a+(b.price*b.qty),0) : 0);
        const prodCount = s.items ? s.items.length : (s.product?1:0);
        rows.push([s.id, s.date, s.client, Number(total).toFixed(2), s.status, prodCount]);
      });
      const csv = rows.map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `ventas_export_${new Date().toISOString().slice(0,10)}.csv`; a.click(); URL.revokeObjectURL(url);
    }

    function duplicateSale(id){
      const sale = allSales.find(s=>s.id===id); if(!sale) return alert('Venta no encontrada');
      const copy = JSON.parse(JSON.stringify(sale));
      copy.id = new Date().toISOString().replace(/[^0-9]/g,'').slice(0,14);
      copy.date = new Date().toISOString().slice(0,10);
      // prepend
      allSales.unshift(copy);
      saveSales();
      filteredSales = [...allSales];
      currentPage = 1; renderSales();
      alert('Venta duplicada con id: ' + copy.id);
    }

    function downloadSaleCSV(id){
      const sale = allSales.find(s=>s.id===id); if(!sale) return alert('Venta no encontrada');
      const rows = [['producto','precio','cantidad','subtotal']];
      if(sale.items && sale.items.length){
        sale.items.forEach(it=> rows.push([it.name, Number(it.price).toFixed(2), it.qty, Number(it.price*it.qty).toFixed(2)]));
      } else {
        rows.push([sale.product || '', Number(sale.price||0).toFixed(2), sale.qty||1, Number((sale.price||0)*(sale.qty||1)).toFixed(2)]);
      }
      rows.push([]);
      rows.push(['Subtotal', sale.subtotal || '']);
      rows.push(['IGV', sale.tax || '']);
      rows.push(['Total', sale.total || '']);
      const csv = rows.map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `venta_${id}.csv`; a.click(); URL.revokeObjectURL(url);
    }

    function printSale(id){
      const url = `sale-details.html?id=${encodeURIComponent(id)}&print=1`;
      window.open(url, '_blank');
    }

    function filterSales() {
      const search = document.getElementById('search-sales').value.toLowerCase();
      const statusFilter = document.getElementById('filter-status').value;
      const dateFrom = document.getElementById('filter-date-from').value;
      const dateTo = document.getElementById('filter-date-to').value;

      filteredSales = allSales.filter(s => {
        const matchSearch = s.id.toLowerCase().includes(search) || s.client.toLowerCase().includes(search) || s.product.toLowerCase().includes(search);
        const matchStatus = !statusFilter || s.status === statusFilter;
        const matchDate = (!dateFrom || s.date >= dateFrom) && (!dateTo || s.date <= dateTo);
        return matchSearch && matchStatus && matchDate;
      });

      currentPage = 1;
      renderSales();
    }

    function clearSalesFilters() {
      document.getElementById('search-sales').value = '';
      document.getElementById('filter-status').value = '';
      document.getElementById('filter-date-from').value = '';
      document.getElementById('filter-date-to').value = '';
      filteredSales = [...allSales];
      currentPage = 1;
      renderSales();
    }

    function previousPage(e) {
      e.preventDefault();
      if(currentPage > 1) { currentPage--; renderSales(); }
    }

    function nextPage(e) {
      e.preventDefault();
      const totalPages = Math.ceil(filteredSales.length / itemsPerPage);
      if(currentPage < totalPages) { currentPage++; renderSales(); }
    }

    function openDetails(saleId) {
      const sale = allSales.find(s => s.id === saleId);
      currentSaleId = saleId;

      const subtotal = sale.qty * sale.price;
      const tax = subtotal * 0.18;
      const total = subtotal + tax;

      document.getElementById('modal-order-id').textContent = saleId;
      document.getElementById('modal-date').textContent = sale.date;
      document.getElementById('modal-client').textContent = sale.client;
      document.getElementById('modal-phone').textContent = sale.phone;
      document.getElementById('modal-address').textContent = sale.address;
      document.getElementById('modal-status-select').value = sale.status;

      const itemsHtml = `
        <tr>
          <td>${sale.product}</td>
          <td>${sale.qty}</td>
          <td>S/ ${sale.price.toFixed(2)}</td>
          <td>S/ ${subtotal.toFixed(2)}</td>
        </tr>
      `;
      document.getElementById('modal-items').innerHTML = itemsHtml;
      document.getElementById('modal-subtotal').textContent = 'S/ ' + subtotal.toFixed(2);
      document.getElementById('modal-tax').textContent = 'S/ ' + tax.toFixed(2);
      document.getElementById('modal-total').textContent = 'S/ ' + total.toFixed(2);

      const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
      modal.show();
    }

    function updateOrderStatus() {
      const newStatus = document.getElementById('modal-status-select').value;
      const sale = allSales.find(s => s.id === currentSaleId);
      if(sale) {
        sale.status = newStatus;
        saveSales();
        renderSales();
        alert('✓ Estado actualizado a: ' + newStatus);
      }
    }

    function cancelOrder(saleId) {
      if(confirm('¿Deseas cancelar este pedido?')) {
        const sale = allSales.find(s => s.id === saleId);
        if(sale) {
            sale.status = 'cancelado';
            saveSales();
            renderSales();
            alert('✓ Pedido cancelado');
          }
      }
    }

      function saveSales(){
        try{ localStorage.setItem('sales', JSON.stringify(allSales)); }catch(e){ console.error('saveSales err',e); }
      }

    function printOrder() {
      window.print();
    }

    // Sidebar collapse toggle
    document.getElementById('iconSidenav')?.addEventListener('click', function(){
      document.querySelector('body').classList.toggle('my-sidenav-open');
    });

    // Handle submenu collapse
    document.querySelectorAll('.nav-link.collapsed').forEach(el => {
      el.addEventListener('click', function() {
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.classList.toggle('show');
          this.setAttribute('aria-expanded', target.classList.contains('show'));
        }
      });
    });
  </script>

</body>

</html>
