<!--
=========================================================
* Corporate UI - Lista de Ventas
=========================================================
-->
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <title>Lista de Ventas</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Noto+Sans:300,400,500,600,700,800|PT+Mono:300,400,500,600,700" rel="stylesheet" />
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/349ee9c857.js" crossorigin="anonymous"></script>
  <link id="pagestyle" href="../assets/css/corporate-ui-dashboard.css?v=1.0.0" rel="stylesheet" />
  <style>
    .filter-card { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
    .badge-status { padding: 6px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 600; }
    .badge-pendiente { background: #ffeaa7; color: #d63031; }
    .badge-confirmado { background: #b2ebf2; color: #01579b; }
    .badge-enviado { background: #b2dfdb; color: #004d40; }
    .badge-entregado { background: #c8e6c9; color: #1b5e20; }
    .badge-cancelado { background: #ffccbc; color: #bf360c; }
    .modal-body { max-height: 80vh; overflow-y: auto; }
    .detail-row { border-bottom: 1px solid #e9ecef; padding: 10px 0; }
    .detail-row:last-child { border-bottom: none; }
    @media (min-width:1200px){
      aside.sidenav{ width:260px; }
      main.main-content{ transition: margin-left .25s ease; margin-left:260px; }
      body.my-sidenav-collapsed main.main-content{ margin-left:0 !important; }
    }
    #sidenav-backdrop{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:1040; }
    body.my-sidenav-open #sidenav-backdrop{ display:block; }
    @media (min-width:1200px){ #sidenav-backdrop{ display:none !important; } }
  </style>
</head>

<body class="g-sidenav-show bg-gray-100">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 bg-slate-900 fixed-start" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand d-flex align-items-center m-0" href="dashboard.html">
        <span class="font-weight-bold text-lg">D'Cesar</span>
      </a>
    </div>
    <div class="collapse navbar-collapse px-4 w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="dashboard.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><svg width="30px" height="30px" viewBox="0 0 48 48" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="dashboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="template" transform="translate(12.000000, 12.000000)" fill="#FFFFFF" fill-rule="nonzero"><path class="color-foreground" d="M0,1.71428571 C0,0.76752 0.76752,0 1.71428571,0 L22.2857143,0 C23.2325143,0 24,0.76752 24,1.71428571 L24,5.14285714 C24,6.08962286 23.2325143,6.85714286 22.2857143,6.85714286 L1.71428571,6.85714286 C0.76752,6.85714286 0,6.08962286 0,5.14285714 L0,1.71428571 Z" id="Path"></path><path class="color-background" d="M0,12 C0,11.0532171 0.76752,10.2857143 1.71428571,10.2857143 L12,10.2857143 C12.9468,10.2857143 13.7142857,11.0532171 13.7142857,12 L13.7142857,22.2857143 C13.7142857,23.2325143 12.9468,24 12,24 L1.71428571,24 C0.76752,24 0,23.2325143 0,22.2857143 L0,12 Z" id="Path"></path><path class="color-background" d="M18.8571429,10.2857143 C17.9103429,10.2857143 17.1428571,11.0532171 17.1428571,12 L17.1428571,22.2857143 C17.1428571,23.2325143 17.9103429,24 18.8571429,24 L22.2857143,24 C23.2325143,24 24,23.2325143 24,22.2857143 L24,12 C24,11.0532171 23.2325143,10.2857143 22.2857143,10.2857143 L18.8571429,10.2857143 Z" id="Path"></path></g></g></svg></div><span class="nav-link-text ms-1">Dashboard</span></a></li>
        <li class="nav-item"><a class="nav-link" href="users-list.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><svg width="30px" height="30px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M24 24a6 6 0 110-12 6 6 0 010 12z" fill="#FFFFFF"/><path d="M8 32c0-3.3 2-6 6-8h20c4 2 6 4.7 6 8v8H8v-8z" fill="#FFFFFF" opacity="0.7"/></svg></div><span class="nav-link-text ms-1">Usuarios</span></a></li>
        <li class="nav-item"><a class="nav-link" href="productos.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><svg width="30px" height="30px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M6 12h36v24H6z" fill="#FFFFFF" opacity="0.7"/><path d="M12 6h24v6H12z" fill="#FFFFFF"/></svg></div><span class="nav-link-text ms-1">Productos</span></a></li>
        <li class="nav-item"><a class="nav-link" href="reportes.html"><div class="icon icon-shape icon-sm px-0 text-center d-flex align-items-center justify-content-center"><svg width="30px" height="30px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M8 8h32v28H8z" fill="#FFFFFF" opacity="0.7"/><path d="M12 16h4v8h-4z" fill="#FFFFFF"/><path d="M22 12h4v12h-4z" fill="#FFFFFF"/><path d="M32 14h4v10h-4z" fill="#FFFFFF"/></svg></div><span class="nav-link-text ms-1">Reportes</span></a></li>
      </ul>
    </div>
  </aside>

  <div id="sidenav-backdrop"></div>

  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <nav class="navbar navbar-main navbar-expand-lg mx-5 px-0 shadow-none rounded" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-2">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-1 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="dashboard.html">Dashboard</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Lista de Ventas</li>
          </ol>
          <h6 class="font-weight-bold mb-0">Gestión de Pedidos</h6>
        </nav>
      </div>
    </nav>

    <div class="container-fluid py-4 px-5">
      <div class="row mb-4">
        <div class="col-md-12">
          <h3 class="font-weight-bold">Lista de Ventas y Pedidos</h3>
        </div>
      </div>

      <!-- FILTROS -->
      <div class="filter-card">
        <div class="row g-2 align-items-end">
          <div class="col-md-2">
            <input type="text" class="form-control form-control-sm" id="search-sales" placeholder="Buscar orden, cliente..." onkeyup="filterSales()">
          </div>
          <div class="col-md-2">
            <input type="date" class="form-control form-control-sm" id="filter-date-from">
          </div>
          <div class="col-md-2">
            <input type="date" class="form-control form-control-sm" id="filter-date-to">
          </div>
          <div class="col-md-2">
            <select class="form-control form-control-sm" id="filter-status" onchange="filterSales()">
              <option value="">Todos los estados</option>
              <option value="pendiente">Pendiente</option>
              <option value="confirmado">Confirmado</option>
              <option value="enviado">Enviado</option>
              <option value="entregado">Entregado</option>
              <option value="cancelado">Cancelado</option>
            </select>
          </div>
          <div class="col-md-2">
            <button class="btn btn-sm btn-dark w-100" onclick="filterSales()"><i class="fa fa-search me-1"></i>Buscar</button>
          </div>
          <div class="col-md-2">
            <button class="btn btn-sm btn-white w-100" onclick="clearSalesFilters()"><i class="fa fa-redo me-1"></i>Limpiar</button>
          </div>
        </div>
      </div>

      <!-- TABLA DE VENTAS -->
      <div class="row">
        <div class="col-lg-12">
          <div class="card shadow-xs border">
            <div class="card-header border-bottom pb-3">
              <h6 class="font-weight-semibold mb-0">Órdenes de Venta</h6>
            </div>
            <div class="card-body px-0 py-0">
              <div class="table-responsive p-3">
                <table class="table table-hover align-items-center mb-0">
                  <thead class="bg-light">
                    <tr>
                      <th>Orden</th>
                      <th>Fecha</th>
                      <th>Cliente</th>
                      <th>Producto</th>
                      <th>Cantidad</th>
                      <th>Total</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="sales-tbody">
                    <!-- Se cargarán las ventas aquí -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PAGINACION -->
      <div class="row mt-3">
        <div class="col-lg-12 text-center">
          <nav>
            <ul class="pagination justify-content-center">
              <li class="page-item" id="prev-btn"><a class="page-link" href="#" onclick="previousPage(event)">Anterior</a></li>
              <li class="page-item active" id="page-info"><span class="page-link">Página 1 de <span id="total-pages">1</span></span></li>
              <li class="page-item" id="next-btn"><a class="page-link" href="#" onclick="nextPage(event)">Siguiente</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </div>

    <footer class="footer pt-3">
      <div class="container-fluid">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-lg-6 mb-lg-0 mb-4">
            <div class="copyright text-center text-xs text-muted text-lg-start">
              Copyright © <script>document.write(new Date().getFullYear())</script> D'Cesar
            </div>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <!-- MODAL DETALLES -->
  <div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalles de Pedido <span id="modal-order-id"></span></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="detail-row">
            <h6>Información del Pedido</h6>
            <p>Fecha: <strong id="modal-date"></strong> | Cliente: <strong id="modal-client"></strong> | Teléfono: <strong id="modal-phone"></strong></p>
          </div>
          <div class="detail-row">
            <h6>Dirección de Envío</h6>
            <p id="modal-address"></p>
          </div>
          <div class="detail-row">
            <h6>Productos</h6>
            <table class="table table-sm">
              <thead class="bg-light">
                <tr>
                  <th>Producto</th>
                  <th>Cantidad</th>
                  <th>Precio</th>
                  <th>Subtotal</th>
                </tr>
              </thead>
              <tbody id="modal-items"></tbody>
            </table>
          </div>
          <div class="detail-row">
            <h6>Resumen</h6>
            <p>Subtotal: <strong id="modal-subtotal"></strong> | IGV (18%): <strong id="modal-tax"></strong></p>
            <p style="font-size: 1.1rem;">Total: <strong id="modal-total" style="color: #667eea;"></strong></p>
          </div>
          <div class="detail-row">
            <h6>Cambiar Estado</h6>
            <select class="form-control form-control-sm" id="modal-status-select" onchange="updateOrderStatus()" style="max-width: 200px;">
              <option value="pendiente">Pendiente</option>
              <option value="confirmado">Confirmado</option>
              <option value="enviado">Enviado</option>
              <option value="entregado">Entregado</option>
              <option value="cancelado">Cancelado</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-sm btn-white" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-sm btn-primary" onclick="printOrder()"><i class="fa fa-print me-1"></i>Imprimir</button>
        </div>
      </div>
    </div>
  </div>

  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/corporate-ui-dashboard.min.js?v=1.0.0"></script>

  <script>
    const itemsPerPage = 10;
    let currentPage = 1;
    let currentSaleId = null;

    let allSales = [
      { id: '2024-001', date: '2024-11-25', client: 'Juan García Loor', phone: '+51 999 123 456', address: 'Av. Libertad 456, Lima', product: 'Foco LED H7', qty: 5, price: 45.90, status: 'pendiente' },
      { id: '2024-002', date: '2024-11-25', client: 'María Rodríguez', phone: '+51 987 654 321', address: 'Calle Amazonas 789, Lima', product: 'Alternador Denso', qty: 2, price: 380.50, status: 'confirmado' },
      { id: '2024-003', date: '2024-11-24', client: 'Carlos López Soto', phone: '+51 912 345 678', address: 'Jr. Bolívar 123, Callao', product: 'Regulador Alternador', qty: 8, price: 65.00, status: 'enviado' },
      { id: '2024-004', date: '2024-11-24', client: 'Sofia Martinez', phone: '+51 901 234 567', address: 'Pasaje Central 321, Breña', product: 'Rotor Alternador', qty: 3, price: 95.30, status: 'entregado' },
      { id: '2024-005', date: '2024-11-23', client: 'Roberto Díaz', phone: '+51 945 678 901', address: 'Av. Benavides 654, Surco', product: 'Foco LED H7', qty: 10, price: 45.90, status: 'cancelado' },
      { id: '2024-006', date: '2024-11-23', client: 'Ana Flores', phone: '+51 934 567 890', address: 'Calle Colón 456, Miraflores', product: 'Alternador Denso', qty: 1, price: 380.50, status: 'pendiente' },
      { id: '2024-007', date: '2024-11-22', client: 'Miguel Torres', phone: '+51 923 456 789', address: 'Jr. Principal 789, Ate', product: 'Regulador Alternador', qty: 5, price: 65.00, status: 'confirmado' },
      { id: '2024-008', date: '2024-11-22', client: 'Patricia Ruiz', phone: '+51 912 345 678', address: 'Av. Larcomar 111, Chorrillos', product: 'Rotor Alternador', qty: 2, price: 95.30, status: 'entregado' }
    ];
    let filteredSales = [...allSales];

    document.addEventListener('DOMContentLoaded', function() {
      setupSidebar();
      renderSales();
    });

    function setupSidebar() {
      const icon = document.getElementById('iconSidenav');
      const backdrop = document.getElementById('sidenav-backdrop');
      if(icon) icon.addEventListener('click', () => document.body.classList.toggle('my-sidenav-open'));
      if(backdrop) backdrop.addEventListener('click', () => document.body.classList.remove('my-sidenav-open'));
    }

    function getStatusBadge(status) {
      return `<span class="badge-status badge-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>`;
    }

    function renderSales() {
      const tbody = document.getElementById('sales-tbody');
      tbody.innerHTML = '';

      const startIdx = (currentPage - 1) * itemsPerPage;
      const endIdx = startIdx + itemsPerPage;
      const pageSales = filteredSales.slice(startIdx, endIdx);

      if(pageSales.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No hay ventas</td></tr>';
        updatePaginationUI();
        return;
      }

      pageSales.forEach(sale => {
        const total = sale.qty * sale.price;
        const row = `
          <tr>
            <td>${sale.id}</td>
            <td>${sale.date}</td>
            <td>${sale.client}</td>
            <td>${sale.product}</td>
            <td>${sale.qty}</td>
            <td>S/ ${total.toFixed(2)}</td>
            <td>${getStatusBadge(sale.status)}</td>
            <td>
              <button class="btn btn-xs btn-dark" onclick="openDetails('${sale.id}')"><i class="fa fa-eye"></i></button>
              <button class="btn btn-xs btn-danger" onclick="cancelOrder('${sale.id}')"><i class="fa fa-times"></i></button>
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      });

      updatePaginationUI();
    }

    function updatePaginationUI() {
      const totalPages = Math.ceil(filteredSales.length / itemsPerPage);
      document.getElementById('total-pages').textContent = totalPages;
      document.getElementById('prev-btn').classList.toggle('disabled', currentPage === 1);
      document.getElementById('next-btn').classList.toggle('disabled', currentPage === totalPages);
    }

    function filterSales() {
      const search = document.getElementById('search-sales').value.toLowerCase();
      const statusFilter = document.getElementById('filter-status').value;
      const dateFrom = document.getElementById('filter-date-from').value;
      const dateTo = document.getElementById('filter-date-to').value;

      filteredSales = allSales.filter(s => {
        const matchSearch = s.id.toLowerCase().includes(search) || s.client.toLowerCase().includes(search) || s.product.toLowerCase().includes(search);
        const matchStatus = !statusFilter || s.status === statusFilter;
        const matchDate = (!dateFrom || s.date >= dateFrom) && (!dateTo || s.date <= dateTo);
        return matchSearch && matchStatus && matchDate;
      });

      currentPage = 1;
      renderSales();
    }

    function clearSalesFilters() {
      document.getElementById('search-sales').value = '';
      document.getElementById('filter-status').value = '';
      document.getElementById('filter-date-from').value = '';
      document.getElementById('filter-date-to').value = '';
      filteredSales = [...allSales];
      currentPage = 1;
      renderSales();
    }

    function previousPage(e) {
      e.preventDefault();
      if(currentPage > 1) { currentPage--; renderSales(); }
    }

    function nextPage(e) {
      e.preventDefault();
      const totalPages = Math.ceil(filteredSales.length / itemsPerPage);
      if(currentPage < totalPages) { currentPage++; renderSales(); }
    }

    function openDetails(saleId) {
      const sale = allSales.find(s => s.id === saleId);
      currentSaleId = saleId;

      const subtotal = sale.qty * sale.price;
      const tax = subtotal * 0.18;
      const total = subtotal + tax;

      document.getElementById('modal-order-id').textContent = saleId;
      document.getElementById('modal-date').textContent = sale.date;
      document.getElementById('modal-client').textContent = sale.client;
      document.getElementById('modal-phone').textContent = sale.phone;
      document.getElementById('modal-address').textContent = sale.address;
      document.getElementById('modal-status-select').value = sale.status;

      const itemsHtml = `
        <tr>
          <td>${sale.product}</td>
          <td>${sale.qty}</td>
          <td>S/ ${sale.price.toFixed(2)}</td>
          <td>S/ ${subtotal.toFixed(2)}</td>
        </tr>
      `;
      document.getElementById('modal-items').innerHTML = itemsHtml;
      document.getElementById('modal-subtotal').textContent = 'S/ ' + subtotal.toFixed(2);
      document.getElementById('modal-tax').textContent = 'S/ ' + tax.toFixed(2);
      document.getElementById('modal-total').textContent = 'S/ ' + total.toFixed(2);

      const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
      modal.show();
    }

    function updateOrderStatus() {
      const newStatus = document.getElementById('modal-status-select').value;
      const sale = allSales.find(s => s.id === currentSaleId);
      if(sale) {
        sale.status = newStatus;
        renderSales();
        alert('✓ Estado actualizado a: ' + newStatus);
      }
    }

    function cancelOrder(saleId) {
      if(confirm('¿Deseas cancelar este pedido?')) {
        const sale = allSales.find(s => s.id === saleId);
        if(sale) {
          sale.status = 'cancelado';
          renderSales();
          alert('✓ Pedido cancelado');
        }
      }
    }

    function printOrder() {
      window.print();
    }
  </script>

</body>

</html>
